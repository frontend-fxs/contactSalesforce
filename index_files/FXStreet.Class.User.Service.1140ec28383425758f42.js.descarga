(window.webpackJsonpfxsSite=window.webpackJsonpfxsSite||[]).push([[95],{145:function(e,t,n){"use strict";var r=n(11),s=n(54).map;r({target:"Array",proto:!0,forced:!n(85)("map")},{map:function(e){return s(this,e,arguments.length>1?arguments[1]:void 0)}})},158:function(e,t,n){"use strict";var r=n(11),s=n(4),i=n(87),o=n(55),a=n(15),u=n(17),l=n(104),c=n(85),f=n(1)("species"),h=[].slice,d=Math.max;r({target:"Array",proto:!0,forced:!c("slice")},{slice:function(e,t){var n,r,c,v=u(this),S=a(v.length),g=o(e,S),w=o(void 0===t?S:t,S);if(i(v)&&("function"!=typeof(n=v.constructor)||n!==Array&&!i(n.prototype)?s(n)&&null===(n=n[f])&&(n=void 0):n=void 0,n===Array||void 0===n))return h.call(v,g,w);for(r=new(void 0===n?Array:n)(d(w-g,0)),c=0;g<w;g++,c++)g in v&&l(r,c,v[g]);return r.length=c,r}})},168:function(e,t,n){"use strict";var r=n(11),s=n(55),i=n(28),o=n(15),a=n(46),u=n(88),l=n(104),c=n(85),f=Math.max,h=Math.min;r({target:"Array",proto:!0,forced:!c("splice")},{splice:function(e,t){var n,r,c,d,v,S,g=a(this),w=o(g.length),U=s(e,w),m=arguments.length;if(0===m?n=r=0:1===m?(n=0,r=w-U):(n=m-2,r=h(f(i(t),0),w-U)),w+n-r>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(c=u(g,r),d=0;d<r;d++)(v=U+d)in g&&l(c,d,g[v]);if(c.length=r,n<r){for(d=U;d<w-r;d++)S=d+n,(v=d+r)in g?g[S]=g[v]:delete g[S];for(d=w;d>w-r+n;d--)delete g[d-1]}else if(n>r)for(d=w-r;d>U;d--)S=d+n-1,(v=d+r-1)in g?g[S]=g[v]:delete g[S];for(d=0;d<n;d++)g[d+U]=arguments[d+2];return g.length=w-r+n,c}})},294:function(e,t,n){var r=n(11),s=n(2),i=n(295).f;r({target:"Object",stat:!0,forced:s((function(){return!Object.getOwnPropertyNames(1)}))},{getOwnPropertyNames:i})},295:function(e,t,n){var r=n(17),s=n(32).f,i={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return o&&"[object Window]"==i.call(e)?function(e){try{return s(e)}catch(e){return o.slice()}}(e):s(r(e))}},440:function(e,t,n){"use strict";n.r(t);var r,s,i,o;n(145),n(158),n(168),n(294);FXStreet.Class.User={},FXStreet.Class.User.Service=(s={},i=function(e){var t=null,n=null,r=null,i=null,o=null,a=null,u=null,l=null,c=null;this.init=function(){(t=new FXStreet.Class.User.Repository).init(),n=new FXStreet.Class.User.Info(e),r=new FXStreet.Class.User.Account(e),i=new FXStreet.Class.User.Dashboard(e),o=new FXStreet.Class.User.Newsletters(e),a=new FXStreet.Class.User.AuthorFollow(e),u=new FXStreet.Class.User.EventFollow(e),l=new FXStreet.Class.User.RatesTable(e),c=new FXStreet.Class.User.Calendar(e)},this.fillUserRepositoryData=function(e){var n=t.get();0===Object.getOwnPropertyNames(n).length||n.email!==e?(t.remove(),s={email:e},t.set(s)):s=n},this.removeUserRepositoryData=function(){t.remove()};var f=[];this.getUserNewsletters=function(e){return e?f[e]?f[e]:s.email===e&&s.newsletterIds?$.when(s.newsletterIds.slice()):(f[e]=o.get(e).then((function(n){var r=n.map((function(e){return e.newsletterId}));return s.email&&s.email===e&&(s.newsletterIds=r.slice(),t.set(s)),f[e]=null,r}),(function(t){return f[e]=null,404===t.status&&(s.newsletterIds=[]),console.log(t),t})),f[e]):$.when([])},this.addNewsletter=function(e,n){return s.email&&s.email===e&&$.inArray(n,s.newsletterIds)>0?$.when():o.insert(e,n).then((function(r){s.email&&s.email===e&&(s.newsletterIds||(s.newsletterIds=[]),s.newsletterIds.push(n),t.set(s))}),(function(e){console.info("addNewsletter error: "+e.statusText)}))},this.removeNewsletter=function(e,n){return s.email&&s.email===e&&-1===$.inArray(n,s.newsletterIds)?$.when():o.delete(e,n).then((function(r){if(s.email&&s.email===e){var i=s.newsletterIds.indexOf(n);-1!==i&&(s.newsletterIds.splice(i,1),t.set(s))}}),(function(e){console.info("removeNewsletter error: "+e.statusText)}))};var h=null;this.getAuthorFollow=function(){return h||(s.authors?$.when(s.authors.slice()):s.email?h=w().then((function(e){return a.get(s.email,FXStreet.Resource.LanguageId,e).then((function(e){return e?(s.authors=e.map((function(e){return e.authorId})),t.set(s),h=null,s.authors.slice()):[]}),(function(e){return h=null,console.info("getAuthorFollow error: "+e.statusText),404===e.status&&(s.authors=[],t.set(s)),e}))}),(function(e){})):$.when([]))},this.addAuthorFollow=function(e){return""!==s.email&&-1===$.inArray(e,s.authors)?w().then((function(n){return a.insert(s.email,FXStreet.Resource.LanguageId,e,n).then((function(n){n&&(s.authors.push(e),t.set(s))}),(function(e){console.error("addAuthorFollow:"+e.statusText)}))})):$.when()},this.removeAuthorFollow=function(e){var n=$.inArray(e,s.authors);return""!==s.email&&-1!==n?w().then((function(r){return a.delete(s.email,FXStreet.Resource.LanguageId,e,r).then((function(e){s.authors.splice(n,1),t.set(s)}),(function(e){console.error("removeAuthorFollow:"+e.statusText)}))})):$.when()};var d=null;this.getEventFollow=function(){return d||(s.events?$.when(s.events.slice()):s.email?d=w().then((function(e){return u.get(s.email,null,e).then((function(e){return e?(s.events=e.map((function(e){return e.postId})),t.set(s),d=null,s.events.slice()):[]}),(function(e){return d=null,console.info("getEventFollow error: "+e.statusText),404===e.status&&(s.events=[],t.set(s)),e}))}),(function(e){})):$.when([]))},this.addEventFollow=function(e){return""!==s.email&&-1===$.inArray(e,s.events)?w().then((function(n){return u.insert(s.email,e,n).then((function(n){n&&(s.events.push(e),t.set(s))}),(function(e){console.error("addEventFollow:"+e.statusText)}))})):$.when()},this.removeEventFollow=function(e){var n=$.inArray(e,s.events);return""!==s.email&&-1!==n?w().then((function(r){return u.delete(s.email,e,r).then((function(e){s.events.splice(n,1),t.set(s)}),(function(e){console.error("removeEventFollow:"+e.statusText)}))})):$.when()},this.addOrUpdateRatesTableSettings=function(e){""!==s.email?w().then((function(n){s.ratesTableSettings&&s.ratesTableSettings.id?l.update(s.ratesTableSettings.id,s.email,e,n).then((function(n){s.ratesTableSettings={customAssetsList:e,id:s.ratesTableSettings.id},t.set(s)}),(function(e){console.error("updateRatesTableSettings : "+e.statusText)})):l.insert(s.email,e,n).then((function(n){n&&(s.ratesTableSettings={customAssetsList:e,id:n.id},t.set(s))}),(function(e){console.info("addRatesTableSettings error:"+e.statusText)}))})):(s.ratesTableSettings={customAssetsList:e},t.set(s))};var v=null;this.getRatesTableSettings=function(){return v||(s.ratesTableSettings&&s.ratesTableSettings.customAssetsList?$.when(s.ratesTableSettings.customAssetsList.slice()):s.email?v=w().then((function(e){return l.get(s.email,e).then((function(e){return e?(s.ratesTableSettings={id:e[0].id,customAssetsList:e[0].customAssetsList},t.set(s),v=null,s.ratesTableSettings.customAssetsList.slice()):[]}),(function(e){return v=null,console.info("setRatesTable error: "+e.statusText),404===e.status&&(s.ratesTableSettings={customAssetsList:[]}),e}))}),(function(e){})):$.when([]))},this.removeRatesTableSettings=function(){""!==s.email?w().then((function(e){l.remove(s.ratesTableSettings.id,e).then((function(e){s.ratesTableSettings=null,t.set(s)}),(function(e){console.info("addRatesTableSettings error:"+e.statusText)}))})):(s.ratesTableSettings=null,t.set(s))};var S=null;this.getCalendarSettings=function(e){return S||(!e&&s.calendarSettings&&s.calendarSettings.eventNotifications?$.when(s.calendarSettings.eventNotifications.slice()):s.email?S=w().then((function(e){return c.get(s.email,e).then((function(e){return e?(s.calendarSettings={id:e[0].id,eventNotifications:e[0].eventNotifications},t.set(s),S=null,s.calendarSettings.eventNotifications.slice()):[]}),(function(e){return S=null,console.info("setCalendar error: "+e.statusText),404===e.status&&(s.calendarSettings={eventNotifications:[]}),e}))}),(function(e){})):$.when([]))},this.addOrUpdateCalendarSettings=function(e){""!==s.email?w().then((function(n){s.calendarSettings&&s.calendarSettings.id?c.update(s.calendarSettings.id,s.email,e,n).then((function(n){s.calendarSettings={eventNotifications:e,id:s.calendarSettings.id},t.set(s)}),(function(e){console.error("updateCalendarSettings : "+e.statusText)})):c.insert(s.email,e,n).then((function(n){n&&(s.calendarSettings={eventNotifications:e,id:n.id},t.set(s))}),(function(e){console.info("addCalendarSettings error:"+e.statusText)}))})):(s.calendarSettings={eventNotifications:e},t.set(s))},this.getUserNewslettersWithoutLogin=function(e){return o.get(e).then((function(e){return e.map((function(e){return e.newsletterId}))}))};var g=null;this.getUserInfo=function(){if(g)return g;if(s.info)return $.when($.extend({},s.info));var e=FXStreet.Resource.UserInfo.Id;return e?g=w().then((function(r){return n.get(e,r).then((function(e){return e?(s.info=e,t.set(s),g=null,$.extend({},s.info)):null}),(function(e){return g=null,console.info("getUserInfo error: "+e.statusText),404===e.status&&(s.info=null,t.set(s)),e}))}),(function(e){})):$.when(null)},this.editUserInfo=function(e){var n=FXStreet.Resource.UserInfo.Id;return n?w().then((function(r){return i.edit(n,e,r).then((function(e){return s.info=e,t.set(s),!0}),(function(e){return console.error("editUserInfo error:"+e.statusText),!1}))})):$.when()},this.forgotPassword=function(){return s.email?r.forgotPassword(s.email).then((function(e){return!0}),(function(e){return console.error("forgot password error:"+e.statusText),!1})):$.when([])},this.deleteAccountRequest=function(e,t){return e.email&&t?w().then((function(n){return r.deleteAccount(e,t,n).then((function(){return!0}),(function(e){return console.error("deleteAccountRequest error:"+e.statusText),!1}))})):$.when(!1)};var w=function(){var e=FXStreet.Resource.UserInfo.Token.Access_token,t=FXStreet.Resource.UserInfo.Token.TokenExpirationUtc;if(e&&new Date(t)>new Date){var n={access_token:e,token_type:"bearer",expires_date:t};return $.when(n)}var r={access_token:"InvalidToken",token_type:"bearer",expires_date:t};return console.error("user authorization getValidAuthToken is not valid."),$.when(r)};this.cancelSubscription=function(){var e=FXStreet.Resource.UserInfo.Id;if(e)return w().then((function(t){return i.cancelSubscription(e,t).then((function(e){return e}),(function(e){return console.error("cancelSubscription error:"+e.statusText),null}))}))}},{getInstance:function(e){return r||(r=new i(e)).init(),r}}),FXStreet.Class.User.Info=function(e){var t=FXStreet.Resource.UserAuthApiUrl,n="api/v1/users/";this.get=function(e,r){var s=t+n+e;return FXStreet.Class.User.Utils.restGet(s,r)}},FXStreet.Class.User.Account=function(e){var t=FXStreet.Resource.UserAuthApiUrl,n="api/v1/account/";this.forgotPassword=function(e){var r=t+n+"ForgotPassword",s={email:e};return FXStreet.Class.User.Utils.restPost(r,s,null)},this.edit=function(e,r,s){var i=t+n+e;return FXStreet.Class.User.Utils.restPut(i,r,s)},this.deleteAccount=function(e,r,s){var i=t+n+"DeleteAccountPetition";return FXStreet.Class.User.Utils.restPostWithPassword(i,e,r,s)}},FXStreet.Class.User.Dashboard=function(e){var t=FXStreet.Resource.UserAuthApiUrl,n="api/v1/dashboard/";this.edit=function(e,r,s){var i=t+n+e;return FXStreet.Class.User.Utils.restPut(i,r,s)},this.cancelSubscription=function(e,r){var s=t+n+e+"/cancelsubscription";return FXStreet.Class.User.Utils.restPut(s,null,r)}},FXStreet.Class.User.Newsletters=function(e){var t=FXStreet.Resource.UserNewsletterApiUrl,n="api/v1/usernewsletters";this.get=function(e){var r=t+n+"?email="+e;return FXStreet.Class.User.Utils.restGet(r)},this.insert=function(e,r){var s=t+n,i={Email:e,NewsletterId:r,CountryCode:FXStreet.Resource.UserInfo.CountryCode};return FXStreet.Class.User.Utils.restPost(s,i)},this.delete=function(e,r){var s=t+n+"/"+e+"/"+r;return FXStreet.Class.User.Utils.restDelete(s)}},FXStreet.Class.User.AuthorFollow=function(e){var t=FXStreet.Resource.UserAuthorFollowApiUrl,n="api/v1/userauthorfollows";this.get=function(e,r,s){var i=t+n+"?email="+e+"&languageId="+r;return FXStreet.Class.User.Utils.restGet(i,s)},this.insert=function(e,r,s,i){var o=t+n,a={Email:e,LanguageId:r,AuthorId:s};return FXStreet.Class.User.Utils.restPost(o,a,i)},this.delete=function(e,r,s,i){var o=t+n,a={Email:e,LanguageId:r,AuthorId:s};return FXStreet.Class.User.Utils.restDeleteWithBody(o,a,i)}},FXStreet.Class.User.EventFollow=function(e){var t=FXStreet.Resource.UserEventFollowApiUrl,n="api/v1/usereventfollows";this.get=function(e,r,s){var i=t+n+"?email="+e;return null!==r&&""!==r&&(i=i+"&postId="+r),FXStreet.Class.User.Utils.restGet(i,s)},this.insert=function(e,r,s){var i=t+n,o={Email:e,PostId:r};return FXStreet.Class.User.Utils.restPost(i,o,s)},this.delete=function(e,r,s){var i=t+n,o={Email:e,PostId:r};return FXStreet.Class.User.Utils.restDeleteWithBody(i,o,s)}},FXStreet.Class.User.RatesTable=function(e){var t=FXStreet.Resource.UserSettingsApiUrl,n="api/v1/ratestablesettings";this.get=function(e,r){var s=t+n+"?email="+e;return FXStreet.Class.User.Utils.restGet(s,r)},this.insert=function(e,r,s){var i=t+n,o={Email:e,CustomAssetsList:r};return FXStreet.Class.User.Utils.restPost(i,o,s)},this.update=function(e,r,s,i){var o=t+n+"/"+e,a={Email:r,CustomAssetsList:s};return FXStreet.Class.User.Utils.restPut(o,a,i)},this.remove=function(e,r){var s=t+n+"/"+e;return FXStreet.Class.User.Utils.restDelete(s,r)}},FXStreet.Class.User.Calendar=function(e){var t=FXStreet.Resource.UserSettingsApiUrl,n="api/v1/calendarsettings";this.get=function(e,r){var s=t+n+"?email="+e;return FXStreet.Class.User.Utils.restGet(s,r)},this.insert=function(e,r,s){var i=t+n,o={Email:e,EventNotifications:r};return FXStreet.Class.User.Utils.restPost(i,o,s)},this.update=function(e,r,s,i){var o=t+n+"/"+e,a={Email:r,EventNotifications:s};return FXStreet.Class.User.Utils.restPut(o,a,i)},this.remove=function(e,r){var s=t+n+"/"+e;return FXStreet.Class.User.Utils.restDelete(s,r)}},FXStreet.Class.User.Repository=function(){var e,t=!1;this.init=function(){(t=FXStreet.Util.isStorageAvailable("sessionStorage"))||console.log("sessionStorage is unavailable"),e=sessionStorage},this.get=function(){var n={};if(t){var r=e.getItem("fxsUser");r&&(n=JSON.parse(r))}return n},this.set=function(n){if(t){var r=JSON.stringify(n);e.setItem("fxsUser",r)}},this.remove=function(){t&&e.removeItem("fxsUser")}},FXStreet.Class.User.Utils=(o=function(e,t,n,r){var s={contentType:"application/json",url:t,method:e};if(r){var i=r.token_type+" "+r.access_token;s.beforeSend=function(e){e.setRequestHeader("Authorization",i)}}return n&&(s.data=JSON.stringify(n)),s},{restGet:function(e,t){var n=o("GET",e,null,t);return $.ajax(n)},restPost:function(e,t,n){var r=o("POST",e,t,n);return $.ajax(r)},restPostWithPassword:function(e,t,n,r){var s=function(e,t,n,r,s){var i={contentType:"application/json",url:t,method:e};if(s){var o=s.token_type+" "+s.access_token;i.beforeSend=function(e){e.setRequestHeader("Authorization",o),e.setRequestHeader("Password",r)}}return n&&(i.data=JSON.stringify(n)),i}("POST",e,t,n,r);return $.ajax(s)},restPut:function(e,t,n){var r=o("PUT",e,t,n);return $.ajax(r)},restDelete:function(e,t){var n=o("DELETE",e,null,t);return $.ajax(n)},restDeleteWithBody:function(e,t,n){var r=o("DELETE",e,t,n);return $.ajax(r)}})}}]);
//# sourceMappingURL=FXStreet.Class.User.Service.1140ec28383425758f42.js.map